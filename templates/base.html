{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plateforme de Recettes</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <style>
        /* Style de l'avatar utilisateur */
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        /* Barre de navigation */
        .navbar {
            padding: 0;
        }

        /* Barre de recherche améliorée */
        .search-container {
            position: relative;
            width: 270px;
            max-width: 100%;
        }

        .search-input {
            width: 100%;
            padding: 10px 45px; /* Plus d’espace à gauche pour l’icône */
            border-radius: 25px;
            border: 1px solid #8e7f7f;
            background-color: #f6eded;
            color: #9e6c6c;
            transition: all 0.3s ease-in-out;
            font-size: 14px;
        }

        .search-input:focus {
            outline: none;
            border-color: #405367;
            box-shadow: 0px 0px 8px rgba(176, 158, 160, 0.3);
            background-color: #ffffff;
        }

        .search-container i {
            position: absolute;
            top: 50%;
            left: 15px;
            transform: translateY(-50%);
            color: #9e6c6c;
            font-size: 16px;
        }


        /* Notifications */
        .notification-bell {
            position: relative;
            margin-right: 15px;
        }

        .notification-badge {
            position: absolute;
            top: 4px;
            right: -2px;
            font-size: 0.7rem;
            font-weight: bold;
            padding: 3px 6px;
            border-radius: 50%;
        }

        /* Suppression du triangle de l'avatar */
        .no-caret::after {
            display: none !important;
        }
        /* --- Slideshow (Diaporama) --- */
.hero {
    position: relative;
    height: 100vh;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    text-align: center;
}

.slideshow {
    position: absolute;
    width: 100%;
    height: 100%;
}

.slide {
    position: absolute;
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    opacity: 0;
    transition: opacity 1.5s ease-in-out;
}

.slide.active {
    opacity: 1;
}

/* --- Overlay sombre --- */
.hero::after {
    content: "";
    position: absolute;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6); /* Ombre sombre pour améliorer la lisibilité */
    z-index: 1;
}

/* --- Texte sur le diaporama --- */
.hero-content {
    position: relative;
    z-index: 2;
    color: white;
    font-family: 'Poppins', sans-serif;
    text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.8); /* Ombre pour le texte */
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100%;
}

.hero-content h1 {
    font-size: 3rem;
    font-weight: bold;
    background: -webkit-linear-gradient(45deg, #957c7c, #f1efee); /* Dégradé pour le titre */
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.hero-content p {
    font-size: 1.3rem;
    margin-bottom: 20px;
    max-width: 800px;
}

/* --- Navbar --- */
.navbar {
    background: linear-gradient(45deg, #030303, #1e1c1c); /* Dégradé sombre pour la navbar */
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.3); /* Ombre portée pour la navbar */
    padding: 0px 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: sticky;
    top: 0;
    z-index: 1000;
}

/* Liens de la Navbar */
.navbar .nav-link {
    font-size: 1rem;
    color: white; /* Couleur claire pour les liens */
    padding: 12px 18px;
    transition: color 0.3s ease, transform 0.3s ease;
}

/* Effet de survol des liens */
.navbar .nav-link:hover {
    color: #ffb47e; /* Couleur dorée au survol */
    transform: translateY(-3px);
}

/* Lien Connexion avec effet de mise en valeur */
.navbar .nav-item .nav-link.connexion {
    font-weight: bold;
}

/* Lien Inscription personnalisé avec bordure et effet de survol */
.navbar .nav-item .nav-link.inscription {
    border: 2px solid white; /* Bordure blanche */
    border-radius: 8px;
    padding: 10px 20px;
    font-weight: bold;
    transition: background-color 0.3s ease, transform 0.3s ease;
}

/* Effet de survol du lien Inscription */
.navbar .nav-item .nav-link.inscription:hover {
    background-color: rgb(211, 134, 40); /* Couleur orange au survol */
    color: #333; /* Texte sombre */
    transform: scale(1.1);
}

/* Effet sur les éléments de la navbar */
.navbar .nav-item:hover {
    transform: translateY(-2px); /* Effet d'élévation au survol */
    transition: transform 0.3s ease-in-out;
}

/* --- Navbar responsive (adaptation pour petits écrans) --- */
@media (max-width: 768px) {
    .navbar {
        flex-direction: column;
        align-items: center; /* Centrer les éléments pour les petits écrans */
    }

    .navbar .nav-link {
        margin-bottom: 10px;
    }
}

/* --- Boutons --- */
.btn-custom, .btn-primary-custom {
    font-size: 1.1rem;
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: bold;
    text-transform: uppercase;
    transition: all 0.3s ease-in-out;
    margin: 10px;
}

/* Bouton principal personnalisé avec dégradé et ombre */
.btn-primary-custom {
    background: linear-gradient(45deg, #917e7e, #5c5555); /* Dégradé de gris */
    color: white;
    border: none;
    letter-spacing: 1px;
    box-shadow: 0px 4px 8px rgba(26, 15, 15, 0.3);
}

/* Effet au survol du bouton principal */
.btn-primary-custom:hover {
    background: linear-gradient(45deg, #c5b0b0, rgb(143, 132, 130)); /* Changement de couleur au survol */
    transform: scale(1.05);
    box-shadow: 0px 6px 12px rgba(35, 33, 33, 0.4);
}

/* Effet au clic du bouton principal */
.btn-primary-custom:active {
    transform: scale(0.98);
    background: #b19691; /* Couleur orange au clic */
}

/* Bouton secondaire avec bordure transparente */
.btn-custom {
    padding: 10px 22px;
    border: 2px solid white; /* Bordure blanche */
    color: white;
    background: transparent; /* Fond transparent */
    letter-spacing: 1px;
}

/* Effet au survol du bouton secondaire */
.btn-custom:hover {
    background: rgb(226, 206, 206); /* Couleur grise claire */
    color: #342d2d; /* Texte sombre */
    transform: scale(1.01);
    box-shadow: 0px 2px 2px rgba(255, 255, 255, 0.3);
}

/* Effet au clic du bouton secondaire */
.btn-custom:active {
    transform: scale(0.98);
    background: #3684d3; /* Couleur bleue au clic */
}

/* --- Logo --- */
.navbar .navbar-brand {
    font-size: 1.7rem; /* Taille du logo */
    font-weight: bold;
    color: #ffffff; /* Couleur de base pour le texte */
    text-transform: uppercase; /* Met le texte en majuscules */
    letter-spacing: 2px; /* Espacement des lettres */
    display: flex;
    align-items: center; /* Aligne verticalement l'emoji avec le texte */
    transition: all 0.3s ease; /* Transition douce pour les effets */
    background: linear-gradient(45deg, #f5f3f2, #7e6060, #dddcd5); /* Dégradé de couleurs pour le texte */
    -webkit-background-clip: text; /* Applique le dégradé au texte uniquement */
    color: transparent; /* Rend le texte transparent pour que le dégradé soit visible */
}

.navbar .navbar-brand .emoji {
    font-size: 2rem; /* Taille de l'emoji */
    margin-right: 10px; /* Espacement entre l'emoji et le texte */
    transition: transform 0.3s ease, color 0.3s ease; /* Transition pour un effet au survol de l'emoji */
    color: #ff6347; /* Couleur initiale de l'emoji */
}

/* Effet de changement de couleur pour l'emoji au survol */
.navbar .navbar-brand:hover .emoji {
    color: #ffeb3b; /* L'emoji devient jaune au survol */
    transform: rotate(15deg); /* L'emoji tourne légèrement au survol */
}

/* --- Effet au survol du logo --- */
.navbar .navbar-brand:hover {
    transform: scale(1.05); /* Agrandissement du logo au survol */
}

/* --- Logo responsive --- */
@media (max-width: 768px) {
    .navbar .navbar-brand {
        font-size: 1.5rem; /* Taille réduite pour les petits écrans */
    }

    .navbar .navbar-brand .emoji {
        font-size: 1.5rem; /* Réduit la taille de l'emoji pour les petits écrans */
    }
}


/* Categorie */

/* Conteneur de l'image avec un zoom fluide et arrondi */
.image-container {
    position: relative;
    overflow: hidden;
    border-radius: 10px;
    margin-bottom: 0px;  /* Ajout de l'espace sous chaque carte */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);  /* Légère ombre autour de l'image */
    height: 250px;  /* Réduction de la hauteur du conteneur pour mieux s'adapter */
    width: 100%;  /* Largeur à 100% pour prendre tout l'espace disponible */
}

/* Image avec ajustement */
.image-container img {
    width: 100%;
    height: 100%;  /* Hauteur ajustée à 100% du conteneur */
    object-fit: cover;  /* L'image couvre l'espace sans déformation */
    transition: transform 0.3s ease-in-out;
}

/* Effet de zoom sur l'image au survol */
.image-container:hover img {
    transform: scale(1.1);  /* Zoom léger au survol */
}

/* Overlay avec fond sombre et texte centré */
.overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.6);  /* Ombre noire semi-transparente */
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    opacity: 0;
    transition: opacity 0.5s ease;  /* Transition pour le fondu */
    padding: 10px;
}

/* Afficher l'overlay au survol */
.image-container:hover .overlay {
    opacity: 1;
}

/* Style du texte dans l'overlay */
.overlay h5,
.overlay p {
    margin: 5px 0;  /* Espace entre titre et description */
    color: #fff;
    font-size: 1.2em;
    text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.7);  /* Ombre portée pour le texte */
}

/* Effet de survol sur le bouton */
.card-body .btn:hover {
    background-color: #0056b3;  /* Changer la couleur du bouton au survol */
    transform: scale(1.05);  /* Légère augmentation du bouton */
    transition: transform 0.2s ease;  /* Transition pour l'effet sur le bouton */
}

/* Style pour le titre des catégories */
.category-title {
    font-family: 'Poppins', sans-serif;  /* Police moderne et élégante */
    font-size: 2.5em;  /* Taille du texte plus grande pour un meilleur impact */
    color: #392222;  /* Couleur sombre pour un contraste agréable */
    text-align: left;  /* Centrer le texte */
    font-weight: 600;  /* Police plus épaisse pour plus de visibilité */
    margin-bottom: 10px;  /* Espace sous le titre */
    padding: 10px 0;
    letter-spacing: 2px;  /* Espacement des lettres pour un effet aérien */

    border-radius: 8px;  /* Coins arrondis pour un design plus doux */
}


.content-section {
    background-color: #f4f4f4;  /* Fond clair */
    padding: 20px;
    border-radius: 8px;
}

.content-section {
    background-color: #f4f4f4;  /* Fond clair */
    background-size: cover;  /* Adapter l'image à la taille */
    background-position: center; /* Centrer l'image */
    padding: 20px;
    border-radius: 8px;
    color: #333;  /* Couleur du texte pour contraster avec le fond */
}



    </style>
</head>
<body>

    <!-- Navbar -->
    <header class="header">
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container">
                <!-- Logo -->
                <a class="navbar-brand" href="{% url 'accueil' %}">
                    <span class="emoji">🍽️</span> Cuisinette
                </a>

                <!-- Bouton pour mobile -->
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse justify-content-between" id="navbarNav">
                    <!-- Barre de recherche -->
                    <form class="search-container mx-auto" method="GET" action="{% url 'search' %}">
                        <i class="fas fa-search"></i>
                        <input class="form-control search-input" type="search" name="q" placeholder="Rechercher..." aria-label="Search">
                    </form>
                    
                    
                    <!-- Liens principaux -->
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'accueil' %}"> Accueil</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'mes_recettes' %}"> Mes Recettes</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'categorie' %}"> Categories</a>                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'favorite' %}"> Favoris</a>
                        </li>
                    </ul>

                    <!-- Notifications et Profil -->
                    <ul class="navbar-nav ms-3 d-flex align-items-center">
                        <!-- Icône de notification -->
                        <li class="nav-item dropdown">
                            <a class="nav-link position-relative" href="#" id="notificationDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-bell fa-lg"></i>
                                {% if unread_notifications_count > 0 %}
                                <span class="badge bg-danger notification-badge">
                                    {{ unread_notifications_count }}
                                </span>
                                {% endif %}
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="notificationDropdown"
                                    style="width: 350px; height: 450px; overflow-y: auto; border-radius: 10px;">
                                <li class="dropdown-header fw-bold px-3 py-2">Notifications</li>
                                
                                {% for notif in notifications %}
    <li class="px-2 py-2 {% if not notif.is_read %}bg-light{% endif %} border-bottom" style="cursor: pointer;">
        <div class="d-flex align-items-start">
            <!-- Image utilisateur avec fallback -->
            <div class="me-2">
                <img src="{% if notif.sender.profile_picture %}{{ notif.sender.profile_picture.url }}{% else %}{% static 'images/user.jpg' %}{% endif %}" alt="User Image" class="rounded-circle" style="width: 40px; height: 40px;">

            </div>
            <div class="flex-grow-1">
                <div class="{% if not notif.is_read %}fw-bold{% endif %}">
                    <small>{{ notif.message }}</small>
                </div>
                <div>
                    <small class="text-muted">{{ notif.created_at|timesince }} ago</small>
                </div>
            </div>
        </div>
    </li>
{% empty %}
    <li class="px-3 py-2 text-muted">Aucune notification</li>
{% endfor %}
                       
                            </ul>
                        </li>

                        <!-- Avatar utilisateur avec menu déroulant -->
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle no-caret d-flex align-items-center" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                                <img src="{% if user.profile_picture %}{{ user.profile_picture.url }}{% else %}{% static 'images/user.jpg' %}{% endif %}" alt="Avatar" class="avatar me-2">
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                                <li>
                                    <a class="dropdown-item" href="{% url 'mes_recettes' %}">
                                      <img src="{% if user.profile_picture %}{{ user.profile_picture.url }}{% else %}{% static 'images/user.jpg' %}{% endif %}"alt="User Image" class="rounded-circle" style="width: 20px; height: 20px;">
                                      {{ user.username }}
                                    </a>
                                  </li>
                                  
                                  <li><a class="dropdown-item" href="{% url 'edit_profile' %}"><i class="fas fa-user-circle"></i> Mon Profil</a></li>
                                  <li><a class="dropdown-item" href="#"><i class="fas fa-cog"></i> Paramètres</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-danger" href="{% url 'logout' %}"><i class="fas fa-sign-out-alt"></i> Déconnexion</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
{% block content %}

{% endblock %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'js/script.js' %}"></script>
    <script>
        document.getElementById('notificationDropdown').addEventListener('click', function() {
            fetch("{% url 'mark_notifications_read' %}")
                .then(res => res.json())
                .then(data => {
                    // ممكن تخفي الـ badge بدون إعادة تحميل:
                    const badge = this.querySelector('.badge');
                    if (badge) badge.remove();
                });
        });
        document.addEventListener("DOMContentLoaded", function () {
    const dropdown = document.getElementById("notificationDropdown");

    dropdown.addEventListener("click", function () {
        fetch("{% url 'mark_notifications_read' %}", {
            method: "POST",
            headers: {
                "X-CSRFToken": "{{ csrf_token }}",
                "Content-Type": "application/json"
            },
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === "ok") {
                const badge = document.querySelector(".notification-badge");
                if (badge) {
                    badge.remove(); // ou badge.style.display = 'none';
                }
            }
        });
    });
});

    </script>        
</body>
</html>
